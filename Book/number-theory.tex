\section{Elementary number theory}

One of the things type theory is great for, is for the formalization of mathematics in a computer proof assistant. Those are programs that can compile any type theoretical construction to check that this construction indeed has the type it was claimed it has.

At this point in our development of type theory there are two areas of mathematics that would be natural to try to do in type theory: discrete mathematics and elementary number theory. Indeed, how does one define in type theory the greatest common divisor of two natural numbers, or how does one show that there are infinitely many primes? How does one even formalize that every non-empty subset of the natural numbers has a least element?

To answer these questions we will run into questions of decidability. How do we write a term that decides wheter a number is prime or not? Or indeed, is it even true that every non-empty subset of the natural numbers has a least element? What about the subset of $\N$ that contains $1$, and it contains $0$ if and only if Goldbach's conjecture holds? Finding the least element of this subset is equivalent to settling the conjecture!

Therefore, we will prove the well-foundedness of the natural numbers for decidable subsets of $\N$. In fact, we will show it for decidable families, because sometimes we don't know in advance whether a family of types is in fact a subtype. A consequence of involving decidability in the well-foundedness of the natural numbers is that for many properties one has to prove that they are decidable. Luckily this is the case: many of the familiar properties that one encounters in number theory are indeed decidable.

\subsection{Decidability}

A common way of reasoning in mathematics is via a proof by contradiction: ``in order to show that $P$ holds we show that it cannot be the case that $P$ doesn't hold". There are no inference rules in type theory that allow us to obtain a term of type $P$ from a term of type $\neg\neg P$. However, for some propositions $P$ one can construct a function $\neg\neg P \to P$. The \emph{decidable propositions} from a class of such propositions $P$ for which we can show $\neg\neg P \to P$.

The following definition of decidability is made for general types, even though we will mostly be interested in the decidabilyt of proposition. The reason will become aparent in a moment, when we show that types with decidable equality are sets. This useful theorem would become trivial if we restricted the notion of decidability to propositions.

\begin{defn}
  A type $A$ is said to be decidable if it comes equipped with a term of type
  \begin{equation*}
    \isdecidable(A)\defeq A+\neg A.
  \end{equation*}
  Decidable propositions are called \define{classical}. We will write
  \begin{equation*}
    \classicalprop \defeq \sm{P:\prop}\isdecidable(P)
  \end{equation*}
  for the type of all classical propositions (with respect to a universe $\UU$).
\end{defn}

\begin{eg}
  The types $\unit$ and $\emptyt$ are decidable. Indeed, we have
  \begin{align*}
    \inl(\ttt) & :\isdecidable(\unit) \\
    \inr(\idfunc) & : \isdecidable(\emptyt).\qedhere
  \end{align*}
  Any type $A$ equipped with a point $a:A$ is decidable.
\end{eg}

\begin{lem}
  For each $m,n:\N$, the types $\EqN(m,n)$, $m\leq n$ and $m<n$ are decidable.
\end{lem}

\begin{proof}
  The proofs in each of the three cases is similar, so we only show that $\EqN(m,n)$ is decidable for each $m,n:\N$. This is done by induction on $m$ and $n$. Note that the types
  \begin{align*}
    \EqN(\zeroN,\zeroN) & \jdeq \unit \\
    \EqN(\zeroN,\succN(n)) & \jdeq \emptyt \\
    \EqN(\succN(m),\zeroN) & \jdeq \emptyt 
  \end{align*}
  are all decidable. Moreover, the type $\EqN(\succN(m),\succN(n))\jdeq \EqN(m,n)$ is decidable by the inductive hypothesis.
\end{proof}

We will now study the concept of decidable equality.

\begin{defn}
  We say that a type $A$ has decidable equality if the identity type $x=y$ is decidable for every $x,y:A$. 
\end{defn}

\begin{cor}
  Equality on the natural numbers is decidable.
\end{cor}

\begin{proof}
  This follows immediately from the equivalences $(m=n)\simeq \EqN(m,n)$, and the fact that $\EqN(m,n)$ is decidable.
\end{proof}

\begin{lem}
  Suppose that $A$ and $B$ are types with decidable equality. Then the coproduct $A+B$ also has decidable equality.
\end{lem}

\begin{proof}
  Our goal is to construct a dependent function
  \begin{equation*}
    d_{A+B} : \prd{z,z':A+B}\isdecidable(z=z').
  \end{equation*}
  This function is constructed by coproduct induction on both $z$ and $z'$, so we have four cases to consider. Recall from \cref{thm:id-coprod-compute} that we have equivalences
  \begin{align*}
    (\inl(x)=\inl(x')) & \simeq (x=x') \\
    (\inl(x)=\inr(y')) & \simeq \emptyt \\
    (\inr(y)=\inl(x')) & \simeq \emptyt \\
    (\inr(y)=\inr(y')) & \simeq (y=y').
  \end{align*}
  Therefore the type $z=z'$ is equivalent to a decidable type in each of the four cases.
\end{proof}

\begin{cor}
  The type $\Z$ has decidable equality.
\end{cor}

\begin{cor}
  For any $n:\N$ the type $\Fin(n)$ has decidable equality. 
\end{cor}

We have already shown in \cref{thm:eq_nat} that the type of natural numbers is a set. In fact, any type with decidable equality is a set. This fact is known as Hedberg's theorem. Our proof of Hedberg's theorem might appear to be slightly complicated compared to the proof in \cite{hottbook}. This is due to the fact that we haven't introduced function extensionality yet, which is used there to observe that $\neg\neg(x=y)$ is a proposition for any $x,y:A$.

\begin{thm}[Hedberg]
  Any type with decidable equality is a set.
\end{thm}

\begin{proof}
  Let $A$ be a type, and let
  \begin{equation*}
    d:\prd{x,y:A}(x=y)+\neg(x=y).
  \end{equation*}
  Our proof is an application of \cref{lem:prop_to_id}. In order to construct a binary relation $R$, we first consider the type family $D(x,y):((\id{x}{y})+\neg(\id{x}{y}))\to\UU$ given by
  \begin{align*}
    D(x,y,\inl(p)) & \defeq \unit \\
    D(x,y,\inr(p)) & \defeq \emptyt.
  \end{align*}
  Now we define the binary relation $R:A\to (A\to\UU)$ by
  \begin{equation*}
    R(x,y)\defeq D(x,y,d(x,y)).
  \end{equation*}
  It follows that $R(x,y)$ is a proposition for every $x,y:A$, since $D(x,y,z)$ is a proposition for every $z:(x=y)+\neg(x=y)$.

  To see that $R$ is reflexive it suffices to construct a term of type
  \begin{equation*}
    \rho':\prd{x:A}{p:(x=x)+\neg(x=x)}D(x,x,p)
  \end{equation*}
  For any $x:A$ we define $\rho'(x)$ by case analysis on $p:(x=x)+\neg(x=x)$. Given $p:x=x$, we take $\rho'(x,\inl(p))\defeq\ttt$. Given $p:\neg(x=x)$, we obtain $p(\refl{x}):\emptyt$, so there is nothing to define in this case. This completes the definition of $\rho'$.
  
  It remains to show that $R(x,y)\to (x=y)$ for any $x,y:A$. Note that it suffices to construct a function
  \begin{equation*}
    \alpha:D(x,y,p)\to (x=y)
  \end{equation*}
  for any $x,y:A$ and $p:(x=y)+\neg(x=y)$. This function is constructed by case analisys on $p$. Given $p:x=y$, we simply define $\alpha(x,y,\inl(p))\defeq p$. Given $p:\neg(x=y)$ the type $D(x,y,p)$ is empty, so there is nothing to define.
\end{proof}

\subsection{The well-ordering principle for decidable families over \texorpdfstring{$\N$}{â„•}}

\begin{defn}
  A family $P$ over a type $A$ is said to be decidable if $P(x)$ is decidable for every $x:A$. A \define{decidable subset} of a type $A$ is a map
  \begin{equation*}
    P:A\to\classicalprop.
  \end{equation*}
\end{defn}

\begin{defn}
  Let $P$ be a decidable family over $\N$, and let $n:\N$ be a natural number equipped with $p:P(n)$. We say that $n$ is a \define{minimal $P$-element} if it comes equipped with a term of type
  \begin{equation*}
    \isminimal_P(n,p)\defeq \Big(\prd{m:\N}P(m)\to (n\leq m)\Big)
  \end{equation*}
\end{defn}

Note that the type $\isminimal_P(n,p)$ doesn't depend on $p$. However, it doesn't make much sense that $n$ is a minimal element of $P$ unless we already know that $n$ is in $P$. Indeed, if we would omit the hypothesis that $n$ is in $P$, it would be more accurate to say that $n$ is a \emph{lower bound} of $P$. The following theorem is the well-ordering principle of $\N$. 

\begin{thm}
  Let $P$ be a decidable family over $\N$. Then there is a function
  \begin{equation*}
    \Big(\sm{n:\N}P(n)\Big)\to\Big(\sm{m:\N}{p:P(m)}\isminimal_P(m,p)\Big).
  \end{equation*}
\end{thm}

\begin{proof}
  Consider a universe $\UU$ that contains $P$. We show by induction on $n:\N$ that there is a function
  \begin{equation*}
    Q(n)\to \Big(\sm{m:\N}{p:Q(m)}\isminimal_Q(m,p)\Big) 
  \end{equation*}
  for every decidable family $Q:\N\to\UU$. Note that we performed a swap in the order of quantification, using the universe that contains $P$. This slightly strengthens the inductive hypothesis, which we will be able to exploit.

  The base case is trivial, since $\zeroN$ is the least natural number. For the inductive step, suppose that $Q(\succN(n))$ holds. Note that $Q(\zeroN)$ is assumed to be decidable, so we proceed by case analysis on $Q(\zeroN)+\neg Q(\zeroN)$. Given $q:Q(\zeroN)$, it follows immediately that $\zeroN$ must be minimal. In the case where $\neg Q(\zeroN)$, we consider the decidable subset $Q'$ of $\N$ given by
  \begin{equation*}
    Q'(n)\defeq Q(\succN(n)).
  \end{equation*}
  Since we have $q:Q'(n)$, we obtain a minimal element in $Q'$ by the inductive hypothesis. Of course, by the assumption that $Q(\zeroN)$ doesn't hold, the minimal element of $Q'$ is also the minimal element of $Q$.
\end{proof}

\subsection{The strong induction principle of \texorpdfstring{$\N$}{N}}

\begin{thm}
  For any type family $P$ over $\N$ there an operation
  \begin{equation*}
    \strongindN : P(\zeroN)\to\Big(\prd{n:\N}\Big(\prd{m:\N}(m\leq n)\to P(m)\Big)\to P(n+1)\Big)\to \Big(\prd{n:\N}P(n)\Big).
  \end{equation*}
  Moreover, the operation $\strongindN$ comes equipped with identifications
  \begin{align*}
    \strongindN(p_0,p_S,\zeroN) & = p_0 \\
    \strongindN(p_0,p_S,n+1) & = p_S(n,(\lam{m}\lam{p}\strongindN(p_0,p_S,m))),
  \end{align*}
  for any $p_0:P(\zeroN)$ and $p_S:\prd{n:\N}\Big(\prd{m:\N}(m\leq n)\to P(m)\Big)\to P(n+1)$.
\end{thm}

\begin{proof}
  Consider
  \begin{align*}
    p_0 & : P(\zeroN) \\
    p_S & : \prd{n:\N}\Big(\prd{m:\N}(m\leq n)\to P(m)\Big)\to P(n+1)
  \end{align*}
  
  First, we claim that there is a function
  \begin{equation*}
    \tilde{p}_0 : \prd{m:\N}(m\leq\zeroN)\to P(m)
  \end{equation*}
  that comes equipped with an identification
  \begin{equation*}
    \tilde{p}_0(\zeroN,p)=p_0
  \end{equation*}
  for any $p:\zeroN\leq\zeroN$. The fact that we have such a dependent function $\tilde{p}_0$ follows immediately by induction on $m$ and $p:m\leq \zeroN$.

  Next, we claim that there is a function
  \begin{equation*}
    \tilde{p}_S : \prd{n:\N}\Big(\prd{m:\N}(m\leq n) \to P(m)\Big)\to \Big(\prd{m:\N}(m\leq n+1)\to P(m)\Big)
  \end{equation*}
  equipped with a homotopy
  \begin{equation*}
    \prd{m:\N}\prd{q:m\leq n}{p:m\leq n+1} \tilde{p}_S(n,H,m,p) = H(m,q)
  \end{equation*}
  and an identification
  \begin{equation*}
    \tilde{p}_S(n,H,n+1,p)=p_S(n,H)
  \end{equation*}
  for every $p:n+1\leq n+1$.

  Using $\tilde{p}_0$ and $\tilde{p}_S$, we obtain by induction on $n$ a function
  \begin{equation*}
    \tilde{s}:\prd{n:\N}\prd{m:\N} (m\leq n)\to P(m)
  \end{equation*}
  satisfying the computation rules
  \begin{align*}
    \tilde{s}(\zeroN) & \jdeq \tilde{p}_0 \\
    \tilde{s}(n+1) & \jdeq \tilde{p}_S(n,\tilde{s}(n)).
  \end{align*}
  Now we define
  \begin{equation*}
    \strongindN(p_0,p_S,n) \defeq \tilde{s}(n,n,\reflleqN(n)),
  \end{equation*}
  where $\reflleqN(n):n\leq n$ is the proof of reflexivity of $\leq$.

  It remains to show that $\strongindN$ satisfies the identifications claimed in the statement of the theorem. The identification that computes $\strongindN$ at $\zeroN$ is easy to obtain:
  \begin{align*}
    \strongindN(p_0,p_S,\zeroN) & \jdeq \tilde{s}(\zeroN,\zeroN,\reflleqN(\zeroN)) \\
                                & \jdeq \tilde{p}_{0}(\zeroN,\reflleqN) \\
                                & = p_0.
  \end{align*}
  To construct the identification that computes $\strongindN$ at a successor, we start with a similar computation:
  \begin{align*}
    \strongindN(p_0,p_S,n+1) & \jdeq \tilde{s}(n+1,n+1,\reflleqN(n+1)) \\
                                   & \jdeq \tilde{p}_S(n,\tilde{s}(n),n+1,\reflleqN(n+1)) \\
    & = p_S(n,\tilde{s}(n))
  \end{align*}
  Thus we see that, in order to show that
  \begin{equation*}
    p_S(n,\tilde{s}(n))=p_S(n,(\lam{m}\lam{p}\tilde{s}(m,m,\reflleqN(m)))),
  \end{equation*}
  we need to prove that
  \begin{equation*}
    \tilde{s}(n)=\lam{m}\lam{p}\tilde{s}(m,m,\reflleqN(m)).
  \end{equation*}
  Here we apply function extensionality, so it suffices to show that
  \begin{equation*}
    \tilde{s}(n,m,p)=\tilde{s}(m,m,\reflleqN(m))
  \end{equation*}
  for every $m:\N$ and $p:m\leq n$. We proceed by induction on $n:\N$. The base case is trivial. For the inductive step, we note that
  \begin{align*}
    \tilde{s}(n+1,m,p)=\tilde{p}_S(n,\tilde{s}(n),m,p)=\begin{cases}\tilde{s}(n,m,p) & \text{if }m\leq n \\
    p_S(n,\tilde{s}(n)) & \text{if }m=n+1.\end{cases}
  \end{align*}
  Therefore it follows by the inductive hypothesis that
  \begin{equation*}
    \tilde{s}(n+1,m,p)=\tilde{s}(m,m,\reflleqN(m))
  \end{equation*}
  if $m\leq n$ holds. In the remaining case, where $m=n+1$, note that we have
  \begin{align*}
    \tilde{s}(\succN,\succN,\reflleqN(\succN)) & = \tilde{p}(n,\tilde{s}(n),n+1,\reflleqN(n+1)) \\
    & = p_S(n,\tilde{s}(n)).
  \end{align*}
  Therefore we see that we also have an identification
  \begin{equation*}
    \tilde{s}(n+1,m,p)=\tilde{s}(m,m,\reflleqN(m))
  \end{equation*}
  when $m=n+1$. This completes the proof of the strong induction principle for $\N$.
\end{proof}

\subsection{The pigeonhole principle}

The pigeonhole principle states that if we place more than $n$ balls in $n$ bags, then at least one bag will contain more than one ball. In this section we will give a type theoretical proof of the pigeonhole principle.

First we give a definition of a function that counts the number of elements in a decidable subset of $\Fin(n)$.

\begin{defn}
  Let $P$ be a decidable subset of $\Fin(n)$. We define the number $|P|:\N$ of elements in $P$.
\end{defn}

\begin{proof}[Construction]
  We give the construction of $|P|$ by induction on $n:\N$. In the base case we note that $\Fin(\zeroN)$ has no elements, so we define $|P|\defeq\zeroN$.

  For the inductive step, we define $|P|$ by case analysis on $P(\inr(\ttt))+\neg P(\inr(\ttt))$. Let $P'$ be the family over $\Fin(n)$ given by $P'(i)\defeq P(\inl(i))$. In the case where $P(\inr(\ttt))$ holds, then we define $|P|\defeq \succN |P'|$. In the case where $P(\inr(\ttt))$ doesn't hold we define $|P|\defeq |P'|$.
\end{proof}

\begin{defn}
  For any $i:\Fin(\succN(n))$ we define a function
  \begin{equation*}
    \skipFin(i):\Fin(n)\to\Fin(\succN(n)).
  \end{equation*}
\end{defn}

\begin{proof}[Construction]
  The function $\skipFin(i)$ is defined by induction on $n:\N$. In the base case, the function
  \begin{equation*}
    \skipFin(i):\Fin(\zeroN)\to\Fin(\succN(\zeroN))
  \end{equation*}
  is defined to be the unique map out of the empty type. In the successor case we define
  \begin{equation*}
    \skipFin(i) : \Fin(\succN(n))\to\Fin(\succN(\succN(n))) 
  \end{equation*}
  by induction on $i:\Fin(\succN(\succN(n)))$. The function
  \begin{equation*}
    \skipFin(\inl(i)):\Fin(\succN(n))\to\Fin(\succN(\succN(n)))
  \end{equation*}
  is a map between coproducts, so it can be defined using the functorial action of coproducts of \cref{ex:coproduct_functor}. We take
  \begin{equation*}
    \skipFin(\inl(i))\defeq \skipFin(i)+\idfunc.
  \end{equation*}
  The function 
  \begin{equation*}
    \skipFin(\inr(i)):\Fin(\succN(n))\to\Fin(\succN(\succN(n)))
  \end{equation*}
  is just the function $\inl$.
\end{proof}

\begin{lem}
  For each $i:\Fin(\succN(n))$, the function
  \begin{equation*}
    \skipFin(i):\Fin(n)\to\Fin(\succN(n))
  \end{equation*}
  is an embedding.
\end{lem}

\begin{proof}
  This assertion is proven by induction on $n$. In the base case, we note that any map out of the empty type is an embedding, by \cref{ex:is-emb-empty}. In the inductive step we proceed by case analysis on $i:\Fin(\succN(\succN(n)))$. In the case of $\inl(i)$ we note that
  \begin{equation*}
    \skipFin(\inl(i))\jdeq \skipFin(i)+\idfunc
  \end{equation*}
  is the functorial action of coproducts on two embeddings. Therefore we conclude by \cref{ex:is-emb-coprod} that this map is an embedding. In the case of $\inr(i)$ we note that $\inl$ is an embedding by \cref{ex:is-emb-inl-inr}.
\end{proof}

\begin{lem}
  Consider a map $g:\Fin(m)\to\Fin(\succN(n))$. Furthermore, suppose that $i:\Fin(\succN(n))$ is not in the image of $g$, i.e.~that $\neg(\fib{g}{i})$. Then we can construct a commuting triangle
  \begin{equation*}
    \begin{tikzcd}
      & \Fin(n) \arrow[d,"\skipFin(i)"] \\
      \Fin(m) \arrow[r,swap,"g"] \arrow[ur,densely dotted,"f"] & \Fin(\succN(n)).
    \end{tikzcd}
  \end{equation*}
\end{lem}

Finally, we prove the pigeonhole principle.

\begin{thm}\label{thm:pigeonhole}
  For any $m,n:\N$ and any function $f:\Fin(m)\to\Fin(n)$, if $m>n$, then there is an $i:\Fin(n)$ which is in the image of more than one point in $\Fin(m)$.
\end{thm}

\begin{proof}
  The pigeonhole principle is proven by induction on $m,n:\N$. In the base case for $m$ there is nothing to show because $m>n$ is empty. For the inductive step on $m$ and the base case for $n$, we note that $\Fin(\succN(m))\jdeq \Fin(m)+\unit$ and $\Fin(\zeroN)\jdeq \emptyt$. Therefore $f:\Fin(\succN(m))\to\Fin(\zeroN)$ is a function from a pointed type to the empty type, which gives us a contradiction.

  It remains to give the inductive step for $n$. Let $i\defeq f(\inr(\ttt)):\Fin(\succN(n))$. Since the ordering relation $<$ on $\N$ is decidable, we can decide whether $i$ is in the image of more than one point in $\Fin(m)$ by deciding whether or not $1<|P|$ holds for
  \begin{equation*}
    P(j)\defeq (f(j)=i)
  \end{equation*}
  If this is the case, this completes the proof.

  Now suppose that $1\not<|P|$. Since $P(\inr(\ttt))$ holds it follows that $|P|=1$. Now we observe that $i$ is not in the image of $f\circ \inl$. Therefore we obtain a commuting square
  \begin{equation*}
    \begin{tikzcd}
      \Fin(m) \arrow[r,densely dotted,"{f'}"] \arrow[d,swap,"\inl"] & \Fin(n) \arrow[d,"{\skipFin(i)}"] \\
      \Fin(\succN(m)) \arrow[r,swap,"f"] & \Fin(\succN(n)).
    \end{tikzcd}
  \end{equation*}

  Note that the induction hypothesis the pigeonhole principle applies to the function $f':\Fin(m)\to\Fin(n)$. Since $m>n$ it follows that there is an element $j:\Fin(n)$ that is in the image of $f'$ of more than one element of $\Fin(m)$. Now we observe that there is an equivalence
  \begin{equation*}
    \fib{f'}{j}\simeq \fib{f}{\skipFin(i,j)}
  \end{equation*}
  because both the left and right maps in the commuting square are embeddings. Therefore we conclude that $\skipFin(i,j)$ is in the image of $f$ of more than one element of $\Fin(\succN(m))$. 
 \end{proof}

\begin{cor}\label{cor:pigeonhole}
  Given $m>n$, no function $\Fin(m)\to\Fin(n)$ is an embedding.
\end{cor}

It is straightforward to see that the statements of \cref{thm:pigeonhole,cor:pigeonhole} are equivalent, and one might argue that the statement of \cref{cor:pigeonhole} is the more `type theoretical way' of phrasing the pigeonhole principle. However, the relation to counting the number of points that get mapped to 

\begin{thm}\label{thm:generalized-pigeonhole}
  For any $m,n:\N$ and any function $f:\Fin(m)\to\Fin(n)$, if $m>kn$ for some $k:\N$, then there is an $i:\Fin(n)$ which is in the image of more than $k$ points in $\Fin(m)$. 
\end{thm}

\subsection{Defining the greatest common divisor}

\begin{lem}
  For any $d,n:\N$, the type $d\mid n$ is decidable.
\end{lem}

\begin{proof}
  We give the proof by case analysis on $(d=\zeroN)+(d\neq\zeroN)$. If $d=\zeroN$, then $d\mid n$ holds if and only if $\zeroN=n$, which is decidable.

  If $d\neq\zeroN$, then it follows that $n\leq nd$. Therefore we obtain by the well-ordering principle of the natural numbers a minimal $m:\N$ that satisfies the decidable property $n\leq md$. Now we observe that $d\mid n$ holds if and only if $n=md$, which is decidable.
\end{proof}

\begin{defn}
  A type family $P$ over $\N$ is said to be \define{bounded from above} by $m$ for some natural number $m$, if it comes equipped with a term of type
  \begin{equation*}
    \isbounded_m(P) \defeq \prd{n:\N}P(n)\to (n\leq m).
  \end{equation*}
\end{defn}

\begin{defn}
  Let $P$ be a type family over $\N$, and consider $p:P(n)$. We say that $n$ is the maximal $P$-number if it comes equipped with a term of type
  \begin{equation*}
    \ismaximal_P(n,p) \defeq \prd{m:\N} P(m)\to m\leq n.
  \end{equation*}
\end{defn}

In the following lemma we show that if a decidable family $P$ is bounded from above and inhabited, then it possesses a maximal element.

\begin{lem}\label{lem:maximal}
  Consider a decidable type family $P$ over $\N$ which is bounded from above by $m$. Then there is a function
  \begin{equation*}
    \maximum_P:\Big(\sm{n:\N}P(n)\Big)\to\Big(\sm{n:\N}{p:P(n)}\ismaximal_P(n,p)\Big).
  \end{equation*}
\end{lem}

\begin{proof}
  We define the asserted function by induction on $m$. In the base case, if we have $p:P(n)$, then it follows from $n\leq 0$ that $n=0$. It follows by the boundedness of $P$ that $(n,p)$ is maximal.

  In the inductive step we proceed by case analysis on $P(\succN(m))$. This is allowed because $P$ is decidable. If we have $q:P(\succN(m))$, then it follows by the boundedness of $P$ that $(\succN(m),q)$ is maximal. If $\neg P(\succN(m))$, then it follows that $P$ is bounded by $m$, which allows us to proceed by recursion.
\end{proof}

\begin{defn}
  For any two natural numbers $m,n$ we define the \define{greatest common divisor} $\gcd(m,n)$, which satisfies the following two properties:
  \begin{enumerate}
  \item We have both $\gcd(m,n)\mid m$ and $\gcd(m,n)\mid n$.
  \item For any $d:\N$ we have $d\mid \gcd(m,n)$ if and only if both $d\mid m$ and $d\mid n$ hold.
  \end{enumerate}
\end{defn}

\begin{proof}[Construction]
  Consider the type family $P(d)\defeq (d\mid m)\times (d\mid n)$. Then $P$ is bounded from above by $m$. Moreover, $P(1)$ holds since $1\mid n$ for any natural number $n$. Furthermore, the divisibility relation is decidable, so it follows that $P$ is a family of decidable types. Now the greatest common divisor is defined as the maximal $P$-element, which is obtained by \cref{lem:maximal}
\end{proof}

\subsection{The Euclidean algorithm}

It was immediate from our definition of the greatest common divisor of $a$ and $b$ that it indeed divides both $a$ and $b$, and that it is the greatest such number. However, as a program that is supposed to \emph{compute} the greatest common divisor of $a$ and $b$ it performs rather poorly: it checks for every $n$ from $1$ until either $a$ or $b$ whether it is a divisor of both $a$ and $b$, and only then it gives as output the largest common divisor that it has found. In this section we give a new definition of an operation
\begin{equation*}
  \gcdeuclid:\N \to (\N \to \N)
\end{equation*}
following Euclid's algorithm, with the opposite qualities: it will compute rather quicky a value for $\gcdeuclid(a,b)$, but it will be left as something to show that this value is indeed the greatest common divisor of $a$ and $b$.

\begin{defn}
  We define a binary operation
  \begin{equation*}
    \gcdeuclid:\N \to (\N\to\N).
  \end{equation*}
\end{defn}

\begin{proof}
  We will define the operation $\gcdeuclid$ with the \emph{strong} induction principle for $\N$, which was given as \cref{ex:strong-induction}. Thus it suffices to construct a function $\N\to\N$, which will provide the values for $\gcdeuclid(\zeroN)$, and a function
  \begin{equation*}
    h_a:\Big(\prd{x:\N}(x\leq a) \to \N\to\N\Big)\to (\N\to\N),
  \end{equation*}
  for every $a:\N$, which will provide the values for $\gcdeuclid(a+1)$.

  In the base case, we simply define
  \begin{equation*}
    \gcdeuclid(\zeroN)\defeq\idfunc.
  \end{equation*}
  For the inductive step, consider a family of maps $F_x:\N\to\N$ indexed by $x\leq a$. We think of $F_x(b)$ as the value for $\gcdeuclid(x,b)$, so our assumption of having such a family of maps $F_x$ is really the assumption that $\gcdeuclid(x,b)$ is defined for every $x\leq a$. Our goal is to construct a map
  \begin{equation*}
    \gcdeuclid(a+1):\N\to\N
  \end{equation*}
  We proceed by strong induction on $b:\N$. In the base case, we define
  \begin{equation*}
    \gcdeuclid(a+1,\zeroN)\defeq a+1.
  \end{equation*}
  For the inductive step, assume that we have a number $G_y:\N$ for every $y\leq b$. Observe that $(b\leq a)+(a<b)$ holds for any $b:B$, see \cref{ex:order_N}. Thus we can proceed by case analysis to define
  \begin{equation*}
    h_a(F,b+1)\defeq
    \begin{cases}
      F_{(a+1)-(b+1)}(b+1) & \text{if }b\leq a\\
      G_{(b+1)-(a+1)} & \text{if }a<b.
    \end{cases}
  \end{equation*}
  This completes the inductive step, and hence we obtain a binary operation
  $\gcdeuclid$ that satisfies
  \begin{align*}
    \gcdeuclid(\zeroN,b) & \jdeq b \\
    \gcdeuclid(a+1,\zeroN) & \jdeq a+1 \\
    \gcdeuclid(a+1,b+1) & \jdeq \gcdeuclid((a+1)-(b+1),b+1) & & \text{if }b\leq a.\\
    \gcdeuclid(succN(a),b+1) & \jdeq \gcdeuclid(a+1,(b+1)-(a+1)) & & \text{if }a<b.\qedhere            
  \end{align*}
\end{proof}

\begin{prp}
  For each $a,b:\N$, the number $\gcdeuclid(a,b)$ is the greatest common divisor of $a$ and $b$.
\end{prp}


\subsection{The trial division primality test}

\begin{thm}
  For any $n:\N$, the proposition $\isprime(n)$ is decidable.
\end{thm}

It is important to note that, even when we prove that a type such as $\isprime(n)$ is decidable, it is only after we \emph{evaluate} the proof term that we know whether the type under consideration has a term or not. In other words, for any given $n$ we don't know right away whether it is prime or not. Evaluating whether $n$ is prime can be computationally costly, so it may be desirable in any specific situation to give a separate mathematical \emph{argument} that decides whether or not the number is prime.

\subsection{Prime decomposition}

We will show now that any natural number $n>0$ can be written as a product of primes
\begin{equation*}
  n=p_1^{k_1}\cdots p_{m}^{k_m}
\end{equation*}
This prime decomposition is unique if we require that the primes $p_i<p_{i+1}$ for each $0<i<m$. In order to establish these facts in type theory, we first have to define finite products.

\subsection{The infinitude of primes}

\begin{thm}
  There are infinitely many primes.
\end{thm}

\begin{proof}
  We will show that for every $n:\N$ there is a prime number that is larger than $n$. In other words, we will construct a term of type
  \begin{equation*}
    \prd{n:\N}\sm{p:\N}\isprime(p)\times (n\leq p).
  \end{equation*}
  Note that the number $n!+1$ is relatively prime to any number $m\leq n$. Therefore the primes in its prime factorization must all be larger than $n$. Thus, the function that assigns to $n$ the least prime factor of $n!+1$ shows that for any $n:\N$ there is a prime number $p$ that is larger than $n$.
\end{proof}

\begin{cor}
  There is a function
  \begin{equation*}
    \primetype : \N \to \sm{p:\N}\isprime(p)
  \end{equation*}
  that sends $n$ to the $n$-th prime. This function is strictly monotone, so it is an embedding.
\end{cor}

\begin{exercises}
\exercise Show that for any $f:\Fin(m)\to\Fin(n)$ and any $i:\Fin(n)$, the type $\fib{f}{i}$ is decidable.
\exercise Consider a decidable type $P(i)$ indexed by $i:\Fin(n)$.
  \begin{subexenum}
  \item Show that the type
    \begin{equation*}
      \prd{i:\Fin(n)}P(i)
    \end{equation*}
    is decidable.
  \item Show that the type
    \begin{equation*}
      \sm{i:\Fin(n)}P(i)
    \end{equation*}
    is decidable.
  \end{subexenum}
\exercise
  \begin{subexenum}
  \item Show that $\N$ and $\bool$ have decidable equality. Hint: to show that $\N$ has decidable equality, show first that the successor function is injective.
  \item Show that if $A$ and $B$ have decidable equality, then so do $A+B$ and $A\times B$. Conclude that $\Z$ has decidable equality.
  \item Show that if $A$ is a retract of a type $B$ with decidable equality, then $A$ also has decidable equality.
  \end{subexenum}
\exercise Define the prime-counting function $\pi:\N\to\N$.
\exercise (The Cantor-Schr\"oder-Bernstein theorem) Let $X$ and $Y$ be two sets with decidable equality, and consider two maps $f:X\to Y$ and $g:Y\to X$, both of which we assume to be injective. Construct an equivalence $X\simeq Y$.
\exercise For any $k:\Z$, define a function $i\mapsto i+k \mod n$ of type $\Fin(n)\to\Fin(n)$. Show that this function is an equivalence.
\exercise For any $k:\Z$, define a function $i\mapsto i\cdot k \mod n$ of type $\Fin(n)\to\Fin(n)$. Show that this function is an equivalence if and only if $\gcd(n,k)=1$.
\exercise Show that
  \begin{equation*}
    \sum_{i=0}^n \binom{n-i}{i}=F_{n+1}
  \end{equation*}
\exercise Show that if $2^n-1$ is prime, then $n$ is prime.
\exercise Prove Fermat's little theorem.
\exercise Extend the definition of the greatest common divisor to all integers.
\exercise Show that
\begin{equation*}
  (\Fin(m)\simeq\Fin(n))\leftrightarrow(m=n).
\end{equation*}
\exercise Show that $\N$ satisfies \define{ordinal induction}, i.e., construct for any type family $P$ over $\N$ a function of type
    \begin{equation*}
      \ordindN : \Big(\prd{k:\N} \Big(\prd{m:\N} (m< k) \to P(m)\Big)\to P(k)\Big) \to \prd{n:\N}P(n).
    \end{equation*}
    Moreover, prove that
    \begin{equation*}
      \ordindN(h,n)=h(n,\lam{m}\lam{p}\ordindN(h,m))
    \end{equation*}
    for any $n:\N$ and any $h:\prd{k:\N}\Big(\prd{m:\N}(m<k)\to P(m)\Big)\to P(k)$.
\end{exercises}
