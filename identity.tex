\chapter{Identity types}
From the perspective of types as proof-relevant propositions, how should we think of \emph{equality} in type theory? Given a type $A$, and two terms $x,y:A$, the equality $\id{x}{y}$ should again be a type. Indeed, we want to \emph{use} type theory to prove equalities. \emph{Dependent} type theory provides us with a convenient setting for this: the equality type $\id{x}{y}$ is dependent on $x,y:A$. 

Then, if $\id{x}{y}$ is to be a type, how should we think of the terms of $\id{x}{y}$. A term $p:\id{x}{y}$ witnesses that $x$ and $y$ are equal terms of type $A$. In other words $p:\id{x}{y}$ is an \emph{identification} of $x$ and $y$. In a proof-relevant world, there might be many terms of type $\id{x}{y}$. I.e.~there might be many identifications of $x$ and $y$. And, since $\id{x}{y}$ is itself a type, we can form the type $\id{p}{q}$ for any two identifications $p,q:\id{x}{y}$. That is, since $\id{x}{y}$ is a type, we may also use the type theory to prove things \emph{about} identifications (for instance, that two given such identifications can themselves be identified), and we may use the type theory to perform constructions with them. As we will see shortly, we can give every type a groupoid-like structure.

Clearly, the equality type should not just be any type dependent on $x,y:A$. Then how do we form the equality type, and what ways are there to use identifications in constructions in type theory? The answer to both these questions is that we will form the identity type as an \emph{inductive} type, generated by just a reflexivity term providing an identification of $x$ to itself. The induction principle then provides us with a way of performing constructions with identifications, such as concatenating them, inverting them, and so on. Thus, the identity type is equipped with a reflexivity term, and further possesses the structure that are generated by its induction principle and by the type theory. This inductive construction of the identity type is elegant, beautifully simple, but far from trivial!

The situation where two terms can be identified in possibly more than one way is analogous to the situation in \emph{homotopy theory}, where two points of a space can be connected by possibly more than one \emph{path}. Indeed, for any two points $x,y$ in a space, there is a \emph{space of paths} from $x$ to $y$. Moreover, between any two paths from $x$ to $y$ there is a space of \emph{homotopies} between them, and so on. This analogy has been made precise by the construction of \emph{homotopical models} of type theory, and it has led to the fruitful research area of \emph{synthetic homotopy theory}, the subfield of \emph{homotopy type theory} that is the topic of this course.

\section{The inductive definition of identity types}
\begin{defn}
Let $A$ be a type with $a:A$. The \define{identity type} of $A$ at $a:A$ is a type family $\idtypevar{A}(a):A\to\type$ that comes equipped with
\begin{equation*}
\refl{a} : \idtypevar{A}(a,a),
\end{equation*}
and satisfies the induction principle that for any $P:\prd{x:A}\idtypevar{A}(a,x)\to\type$ there is a term
\begin{equation*}
\ind{a=} : P(a,\refl{a})\to \prd{x:A}{p:\idtypevar{A}(a,x)}P(x,p)
\end{equation*}
satisfying the computation rule
\begin{equation*}
\ind{a=}(u,a,\refl{a})\jdeq u.
\end{equation*}
\end{defn}

\section{Basic operations on identifications}\label{sec:groupoid}
\begin{defn}\label{defn:groupoid}
Let $A$ be a type. We construct the following operations and identifications:
\begin{enumerate}
\item A \define{concatenation} operation
\begin{equation*}
\mathsf{concat} : \prd*{x,y,z:A} (\id{x}{y})\to(\id{y}{z})\to (\id{x}{z}).
\end{equation*}
We will write $\ct{p}{q}$ for $\mathsf{concat}(p,q)$. Also, we will \emph{associate to the right}, i.e.~by $\ct{p}{q}{r}$ we mean $\ct{p}{(\ct{q}{r})}$.
\item For each $p:\id{x}{y}$ an inverse $\mathsf{inv}(p):\id{y}{x}$. We will write $p^{-1}$ for $\mathsf{inv}(p)$.
\item An \define{associativity operation}
\begin{equation*}
\mathsf{assoc}(p,q,r) : \ct{(\ct{p}{q})}{r}=\ct{p}{(\ct{q}{r})}.
\end{equation*}
\item Left and right \define{unit operations}
\begin{align*}
\mathsf{left\usc{}unit}(p) & : \ct{\refl{x}}{p}=p \\
\mathsf{right\usc{}unit}(p) & : \ct{p}{\refl{y}}=p.
\end{align*}
\item Left and right \define{inverse operations}
\begin{align*}
\mathsf{left\usc{}inv}(p) & : \ct{p^{-1}}{p} = \refl{y} \\
\mathsf{right\usc{}inv}(p) & : \ct{p}{p^{-1}} = \refl{x}
\end{align*}
\end{enumerate}
\end{defn}

\begin{constr}
We construct the concatenation operation by path induction: it suffices to construct
\begin{equation*}
\mathsf{concat}(\refl{x}):\prd*{z:A} (x=z)\to(x=z).
\end{equation*}
Here we take $\mathsf{concat}(\refl{x})_z \jdeq \refl{(x=z)}$. 
Explicitly, the term we have constructed is
\begin{equation*}
\rec{=}(\lam{x}{z}\idfunc[(\id{x}{z})]).\qedhere
\end{equation*}
Next, we construct the inverse operation by path induction. It suffices to construct
\begin{equation*}
\mathsf{inv}(\refl{x}): x=x,
\end{equation*}
for any $x:A$. Here we take $\mathsf{inv}(\refl{x})\defeq \refl{x}$.
\end{constr}

\section{The homotopy interpretation}

\begin{defn}
Let $A$ be a type, and let $B:A\to\type$ be a type family over $A$.
We will construct a \define{transport} operation
\begin{equation*}
\mathsf{transport}^B:\prd*{x,y:A} (\id{x}{y})\to (B(x)\to B(y)).
\end{equation*}
\end{defn}

\begin{defn}\label{defn:path_lifting}
Let $A$ be a type, and let $B:A\to\type$ be a type family over $A$.
We will construct a \define{path lifting} operation
\begin{equation*}
\mathsf{lift}^B : \prd*{x,y:A}{p:\id{x}{y}}{b:B(x)} \id{\pairr{x,b}}{\pairr{y,\trans{p}{b}}}.
\end{equation*}
\end{defn}

\autoref{defn:path_lifting} gives a way to lift a path $p:x=y$ in the base type of a type family, to a path in the $\Sigma$-type. This, along with the basic groupoid operations developed in \autoref{sec:groupoid}, inspired the \emph{homotopy interpretation} of type theory.

\begin{center}
\begin{tabular}{ll}
\toprule
\multicolumn{2}{c}{\large\textbf{The homotopy interpretation}}\\[2ex]
\emph{Type theory} &  \emph{Homotopy theory} \\
\midrule
Types  & Spaces \\
Dependent types & Fibrations \\
Terms & Points \\
Dependent pair type & Total space \\
Identity type & Path fibration\\
\bottomrule
\end{tabular}
\end{center}

\section{Homotopies}
In homotopy type theory, a homotopy is just a pointwise equality between two functions $f$ and $g$.

\begin{defn}
Let $f,g:\prd{x:A}P(x)$ be two dependent functions. The type of \define{homotopies} from $f$ to $g$ is defined as
\begin{equation*}
f\htpy g \defeq \prd{x:A} f(x)=g(x).
\end{equation*}
\end{defn}

Since we formulated homotopies using dependent functions, we may also consider homotopies \emph{between} homotopies, and further homotopies between those higher homotopies. 
Explicitly, if $H,K:f\htpy g$, then the type $H\htpy K$ of homotopies is just the type
\begin{equation*}
\prd{x:A} H(x)=K(x).
\end{equation*}

\begin{defn}
Let $f,g:\prd{x:A}B(x)$. Given a homotopy $H:f\htpy g$, we define the \define{inverse} homotopy $H^{-1}\defeq \lam{x}H(x)^{-1}:g\htpy f$. Given a further homotopy $K:g\htpy h$, we define the \define{concatenation} 
\begin{equation*}
\ct{H}{K}\defeq\lam{x}\ct{H(x)}{K(x)}:f\htpy h.
\end{equation*}
\end{defn}

\begin{comment}
\begin{defn}
We define the following \define{whiskering} operations on homotopies:
\begin{enumerate}
\item Suppose $H:f\htpy g$ for two functions $f,g:A\to B$, and let $h:B\to C$. We define
\begin{equation*}
hH\defeq \lam{x}\ap{h}{H(x)}:h\circ f\htpy h\circ g.
\end{equation*}
\item Suppose $f:A\to B$ and $H:g\htpy h$ for two functions $g,h:B\to C$. We define
\begin{equation*}
Hf\defeq\lam{x}H(f(x)):h\circ f\htpy g\circ f.
\end{equation*}
\end{enumerate}
\end{defn}
\end{comment}

\begin{exercises}
\item \label{ex:trans_triv}Consider two types $A$ and $B$, and let $p:x=y$ in $A$, and $b:B$. Construct an identification
\begin{align*}
\mathsf{trans\usc{}triv}(p,b):\mathsf{transport}^{\lam{x}B}(p,b)=b.
\end{align*}
\item \label{ex:inv_assoc}Let $p:\id{x}{y}$ and $q:\id{y}{z}$. Construct an identification
\begin{align*}
\mathsf{inv\usc{}assoc}(p,q):\id{(\ct{p}{q})^{-1}}{\ct{q^{-1}}{p^{-1}}}.
\end{align*}
\item \label{ex:ap_ap}Let $f:A\to B$ and $g:B\to C$ be maps, and let $p:\id{x}{y}$ in $A$. Construct an identification
\begin{equation*}
\mathsf{ap\usc{}ap}(f,g,p):\ap{g}{\ap{f}{p}}=\ap{gf}{p}.
\end{equation*}
\item \label{ex:inv_ap}Let $f:A\to B$ be a map, and let $p:x=y$. Construct an identification 
\begin{equation*}
\mathsf{inv\usc{}ap}(f,p):\ap{f}{p}^{-1}=\ap{f}{p^{-1}}.
\end{equation*} 
\item \label{ex:trans_ap}Let $f:A\to B$ be a map, and consider $p:x=y$ in $A$, and $q:f(x)=b$ in $B$. Construct an identification
\begin{equation*}
\mathsf{trans\usc{}ap}(p,q):\id{\trans{p}{q}}{\ct{\ap{f}{p}^{-1}}{q}}.
\end{equation*}
Similarly, for $q':b=f(x)$, construct an identification
\begin{equation*}
\mathsf{trans\usc{}ap'}(p,q'):\id{\trans{p}{q}}{\ct{q}{\ap{f}{p}}}.
\end{equation*}
\item \label{ex:inv_con}For any $p:x=y$, $q:y=z$, and $r:x=z$, construct maps
\begin{align*}
\mathsf{inv\usc{}con}(p,q,r) & : (\ct{p}{q}=r)\to (q=\ct{p^{-1}}{r}) \\
\mathsf{con\usc{}inv}(p,q,r) & : (\ct{p}{q}=r)\to (p=\ct{r}{q^{-1}}).
\end{align*}
\item \label{ex:htpy_nat}
\begin{subexenum}
\item Let $f,g:A\to B$ be functions, and consider $H:f\htpy g$ and $p:x=y$ in $A$. Construct the identification
\begin{align*}
\mathsf{htpy\usc{}nat}(H,p) & :\ct{H(x)}{\ap{g}{p}}=\ct{\ap{f}{p}}{H(y)}
\end{align*}
witnessing that the square
\begin{equation*}
\begin{tikzcd}
f(x) \arrow[r,equals,"H(x)"] \arrow[d,equals,swap,"\ap{f}{p}"] & g(x) \arrow[d,equals,"\ap{g}{p}"] \\
f(y) \arrow[r,equals,swap,"H(y)"] & g(y)
\end{tikzcd}
\end{equation*}
commutes.
\item Now let $f:A\to B$, $g:B\to A$, and $H:g\circ f\htpy \idfunc[A]$. 
%Show that the square
%\begin{equation*}
%\begin{tikzcd}
%gfgf(x) \arrow[d,swap,equals,"\ap{gf}{H(x)}"] \arrow[r,equals,"H(gf(x))"] & gf(x) \arrow[d,"H(x)"] \\
%gf(x) \arrow[r,swap,equals,"H(x)"] & x
%\end{tikzcd}
%\end{equation*}
%commutes.
Construct an identification $H(gf(x))=\ap{gf}{H(x)}$, for any $x:A$.
\item Similarly, let $f:A\to B$, $g:B\to A$, and $G:f\circ g\htpy\idfunc[A]$. 
Construct an identification $G(fg(y))=\ap{fg}{G(y)}$, for any $y:B$.
\end{subexenum}
\item \label{ex:int_group_laws}Show that the operations $k,l\mapsto k+l$ and $k\mapsto -k$ on the integers defined in \autoref{ex:int_group_ops} satisfy the group laws:
\begin{align*}
k+(l+m) & = (k+l)+m \\
k+0 & = k \\
0+k & = k \\
k+(-k) & = 0 \\
(-k) + k & = 0,
\end{align*}
and that $k+l=l+k$, making $\pairr{\Z,0,+,-}$ into an abelian group.
\end{exercises}
