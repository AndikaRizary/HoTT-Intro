\chapter{The univalence axiom}

\section{Type extensionality}
\begin{defn}
We define a family of maps
\begin{equation*}
\mathsf{equiv\usc{}eq}\defeq \mathsf{rec}_{=}(\lam{A}\idfunc[A]) : \prd*{A,B:\UU} (\id{A}{B})\to(\eqv{A}{B}).
\end{equation*}
\end{defn}

\begin{defn}
The \define{univalence axiom} asserts that the family of maps $\mathsf{equiv\usc{}eq}$ is a fiberwise equivalence.
\end{defn}

The univalence axiom asserts that equivalent types are equal. It is considered to be an \emph{extensionality principle} for types.

\begin{lem}
The univalence axiom holds if and only if the type
\begin{equation*}
\sm{B:\UU}\eqv{A}{B}
\end{equation*}
is contractible for each $A:\UU$.
\end{lem}

\begin{proof}
By \autoref{thm:id_fundamental}.
\end{proof}

The following construction enables us to make construction by induction on equivalences, analogous to path induction.

\begin{defn}
Let $A:\UU$, and let $P:\prd{B:\UU} (\eqv{A}{B})\to\type$ be a type family. Using the univalence axiom we construct
\begin{equation*}
\mathsf{equiv\usc{}ind}(P,A) : P(A,\idfunc[A])\to \prd{B:\UU}{e:\eqv{A}{B}}P(B,e).
\end{equation*}
\end{defn}

\begin{constr}
Since $\sm{B:\UU}\eqv{A}{B}$ is contractible we have
\begin{equation*}
P(\idfunc[A])\to\prd{\pairr{B,e}:\sm{B:\UU}\eqv{A}{B}}P(B,e)
\end{equation*}
by \autoref{ex:contr_ind}, so we obtain the desired function by uncurrying.
\end{constr}

From now on we will assume that the univalence axiom holds.

\section{Function extensionality}

The first application of the univalence axiom was Voevodsky's proof of \emph{function extensionality}, which we introduce below.

\begin{defn}
Let $f,g:\prd{x:A}B(x)$ be two dependent functions. We define the function
\begin{equation*}
\mathsf{htpy\usc{}eq}(f,g) : (\id{f}{g})\to (f\htpy g)
\end{equation*}
by path induction, sending $\refl{f}$ to $\lam{x}\refl{f(x)}$. The \define{function extensionality principle} asserts that $\mathsf{htpy\usc{}eq}$ is a fiberwise equivalence, for any $A:\type$ and $B:A\to\type$.
\end{defn}

We first show that function extensionality follows from \emph{weak function extensionality}.

\begin{defn}
The \define{weak function extensionality principle} asserts that for any $B:A\to\type$,
\begin{equation*}
\Big(\prd{x:A}\iscontr(B(x))\Big)\to \iscontr\Big(\prd{x:A}B(x)\Big).
\end{equation*}
\end{defn}

\begin{thm}
Weak function extensionality implies function extensionality.
\end{thm}

\begin{proof}
To prove function extensionality, it suffices by \autoref{thm:id_fundamental} to show that
\begin{equation*}
\sm{g:\prd{x:A}B(x)}f\htpy g
\end{equation*}
is contractible.

Assume that products of contractible types are contractible.
Since the type $\sm{b:B(x)}f(x)=b$ is contractible for each $x:X$, it follows by our assumption of weak function extensionality that the type $\prd{x:A}\sm{b:B(x)}f(x)=b$ is contractible. By \autoref{ex:contr_retr} it therefore suffices to show that
\begin{equation*}
\sm{g:\prd{x:A}B(x)}f\htpy g
\end{equation*}
is a retract of the type $\prd{x:A}\sm{b:B(x)}f(x)=b$. We have the functions
\begin{align*}
\mathsf{pi\usc{}sigma} & \defeq \lam{\pairr{g,H}}\lam{x}\pairr{g(x),H(x)} \\
\mathsf{sigma\usc{}pi} & \defeq \lam{p}\pairr{\lam{x}\proj 1(p(x)),\lam{x}\proj 2(p(x))}.
\end{align*}
It remains to show that $\psi\circ\varphi=\idfunc$. Let $\pairr{g,H}:\sum_g f\htpy g$. 
Then we have
\begin{align*}
\mathsf{sigma\usc{}pi}(\mathsf{pi\usc{}sigma}(g,H)) & \jdeq \mathsf{sigma\usc{}pi}(\lam{x}\pairr{g(x),H(x)}) \\
& \jdeq \pairr{\lam{x}g(x),\lam{x}H(x)} \\
& \jdeq \pairr{g,H}.\qedhere
\end{align*}
\end{proof}

\begin{rmk}
Since we assumed the $\eta$-rule for $\Sigma$-types, we also have
\begin{align*}
\mathsf{pi\usc{}sigma}(\mathsf{sigma\usc{}pi}(p)) & \jdeq \mathsf{pi\usc{}sigma}(\pairr{\lam{x}\proj 1(p(x)),\lam{x}\proj 2(p(x))}) \\
& \jdeq \lam{x}\pairr{\proj 1(p(x)),\proj 2(p(x))} \\
& \jdeq \lam{x} p(x) \\
& \jdeq p.
\end{align*}
Therefore, the types $\sum_g f\htpy g$ and $\prod_x\sum_b f(x)=b$ are actually \emph{judgmentally isomorphic}. 
\end{rmk}

\begin{exercises}
\item \label{ex:tr_ap} Show that for any $P:X\to \UU$ and any $p:x=y$ in $X$, we have
\begin{equation*}
\mathsf{equiv\usc{}eq}(\ap{P}{p})=\mathsf{tr}^P(p).
\end{equation*}
\item Use the univalence axiom to show that the type $\sm{A:\UU}\iscontr(A)$ of all contractible types in $\UU$ is contractible.
\item Use the univalence axiom to show that the type $\sm{P:\prop}P$ is contractible.
\item Show that $\eqv{(\eqv{\bool}{\bool})}{\bool}$, and conclude by the univalence axiom that the universe is not a set.
\item Construct by path induction a family of maps
\begin{equation*}
\prd{A,B:\UU}{a:A}{b:B} (\id{\pairr{A,a}}{\pairr{B,b}})\to \sm{e:\eqv{A}{B}}e(a)=b,
\end{equation*}
and show that this map is an equivalence. In other words, an \emph{identification of pointed types} is a base point preserving equivalence.
\item Let $\pairr{A,a}$ and $\pairr{B,b}$ be two pointed types. Construct by path induction a family of maps
\begin{equation*}
\prd{f,g:A\to B}{p:f(a)=b}{q:g(a)=b} (\id{\pairr{f,p}}{\pairr{g,q}})\to \sm{H:f\htpy g} p = \ct{H(a)}{q},
\end{equation*}
and show that this map is an equivalence. In other words, an \emph{identification of pointed maps} is a base point preserving homotopy.
\item Let $C$ be a contractible type with center of contraction $c$. Use the function extensionality principle to show that the map $\lam{f}f(c):(C\to A)\to A$ is an equivalence, for each type $A$.
\end{exercises}
